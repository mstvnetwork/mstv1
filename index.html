<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MSTV NETWORK</title>
<style>
  body, html {
    margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #111; color: #eee;
  }
  h1 {
    text-align: center;
    font-size: 3rem;
    font-weight: 900;
    color: #ffd700;
    margin-top: 1rem;
    text-shadow: 0 0 10px #ffd700;
  }
  .container {
    display: flex;
    max-width: 1200px;
    margin: 1rem auto;
    gap: 1rem;
    flex-wrap: wrap;
    justify-content: center;
  }
  .img-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
    width: 60%;
    min-width: 300px;
  }
  .img-grid img {
    width: 100%;
    height: 80px;
    object-fit: cover;
    border-radius: 6px;
    cursor: pointer;
    filter: brightness(0.85);
    transition: filter 0.3s ease;
  }
  .img-grid img:hover {
    filter: brightness(1);
  }
  .channel-selector {
    width: 30%;
    min-width: 220px;
    background: #222;
    border-radius: 10px;
    padding: 1rem;
    color: #ffd700;
    font-weight: bold;
    font-size: 1.2rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
  select {
    margin-top: 0.8rem;
    padding: 0.6rem;
    font-size: 1rem;
    background: #333;
    color: #ffd700;
    border: none;
    border-radius: 6px;
    cursor: not-allowed; /* Disabled */
  }
  select option {
    background: #333;
    color: #ffd700;
  }
  #player-container {
    max-width: 1200px;
    margin: 2rem auto;
    position: relative;
    background: #000;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 0 20px #ffd700;
  }
  video {
    width: 100%;
    height: auto;
    display: block;
    outline: none;
  }
  video::-webkit-media-controls,
  video::-moz-media-controls,
  video::-ms-media-controls {
    display: none !important;
  }
  #mute-toggle {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 2rem;
    cursor: pointer;
    user-select: none;
    color: #ffd700;
    background: rgba(0,0,0,0.4);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    line-height: 40px;
    text-align: center;
    transition: background 0.3s ease;
    z-index: 10;
  }
  #mute-toggle:hover {
    background: rgba(0,0,0,0.7);
  }
  #fb-follow {
    max-width: 1200px;
    margin: 0.5rem auto 2rem auto;
    display: flex;
    align-items: center;
    gap: 10px;
    color: #4267B2;
    font-weight: 600;
    font-size: 1.2rem;
    cursor: pointer;
    justify-content: center;
  }
  #fb-follow svg {
    width: 28px;
    height: 28px;
    fill: #4267B2;
  }
  footer {
    background: #222;
    color: #aaa;
    text-align: center;
    padding: 1.5rem 1rem;
    font-size: 0.9rem;
    line-height: 1.5;
  }
  footer a {
    color: #ffd700;
    text-decoration: none;
  }
  footer a:hover {
    text-decoration: underline;
  }
  @media (max-width: 768px) {
    .container {
      flex-direction: column;
      width: 95%;
    }
    .img-grid {
      width: 100%;
      grid-template-columns: repeat(2, 1fr);
    }
    .channel-selector {
      width: 100%;
      margin-top: 1rem;
    }
    #player-container {
      width: 95%;
    }
  }
</style>
</head>
<body>

<h1>MSTV NETWORK</h1>

<div class="container">
  <div class="img-grid" id="imgGrid">
    <img src="https://picsum.photos/id/1015/300/180" alt="Sample Image 1" />
    <img src="https://picsum.photos/id/1016/300/180" alt="Sample Image 2" />
    <img src="https://picsum.photos/id/1018/300/180" alt="Sample Image 3" />
    <img src="https://picsum.photos/id/1020/300/180" alt="Sample Image 4" />
    <img src="https://picsum.photos/id/1024/300/180" alt="Sample Image 5" />
    <img src="https://picsum.photos/id/1027/300/180" alt="Sample Image 6" />
  </div>
  

<div id="player-container">
  <video id="videoPlayer" playsinline></video>
  <div id="mute-toggle" title="Mute/Unmute">ðŸ”Š</div>
</div>

<div id="fb-follow" title="Click to follow on Facebook" onclick="window.open('https://facebook.com/yourpage','_blank')">
  <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M22.675 0h-21.35c-.732 0-1.325.593-1.325 1.325v21.351c0 .731.593 1.324 1.325 1.324h11.495v-9.294h-3.124v-3.622h3.124v-2.672c0-3.1 1.894-4.788 4.659-4.788 1.325 0 2.464.099 2.797.143v3.24h-1.918c-1.504 0-1.795.715-1.795 1.763v2.313h3.588l-.467 3.622h-3.12V24h6.116c.73 0 1.324-.593 1.324-1.324V1.325c0-.732-.594-1.325-1.324-1.325z"/></svg>
  Click to follow
</div>

<footer>
  <p><strong>About us:</strong> MSTV NETWORK is your global live streaming platform.</p>
  <p><strong>Disclaimer:</strong> Content is streamed as provided by third-party sources.</p>
  <p>&copy; 2025 MSTV NETWORK. All rights reserved.</p>
</footer>

<script>
(() => {
  const JSON_URL = 'https://mstvnetwork.github.io/mstv1/sync-ch1.json';

  const video = document.getElementById('videoPlayer');
  const muteToggle = document.getElementById('mute-toggle');

  let playlist = [];
  let globalStartTimeUTC = null;
  let playingIndex = -1; // Initialized to -1 to ensure first video loads
  let totalDuration = 0;
  let syncIntervalId = null;

  // Mute toggle and persistence
  function updateMuteIcon() {
    muteToggle.textContent = video.muted ? 'ðŸ”Š' : 'ðŸ”‡';
  }
  function loadMuteState() {
    const saved = localStorage.getItem('mstv_mute_state');
    if (saved === 'unmuted') video.muted = false;
    else video.muted = true;
    updateMuteIcon();
  }
  muteToggle.onclick = () => {
    video.muted = !video.muted;
    updateMuteIcon();
    localStorage.setItem('mstv_mute_state', video.muted ? 'muted' : 'unmuted');
  };

  // Load JSON playlist
  async function loadJSON() {
    try {
      const res = await fetch(JSON_URL);
      if (!res.ok) throw new Error('Failed to fetch playlist JSON');
      const data = await res.json();

      globalStartTimeUTC = new Date(data.start_time_utc);
      playlist = data.video_list || [];
      totalDuration = playlist.reduce((sum, v) => sum + v.duration_seconds, 0);

      if (playlist.length > 0) {
        syncAndPlay();
      }
    } catch (e) {
      console.error('Error loading JSON:', e);
      alert('Failed to load playlist. See console.');
    }
  }

  // Calculate live playback position and load video
  function syncAndPlay() {
    if (!globalStartTimeUTC || playlist.length === 0) return;

    const now = new Date();
    let elapsed = Math.floor((now - globalStartTimeUTC) / 1000);
    if (elapsed < 0) elapsed = 0;

    elapsed = elapsed % totalDuration;

    let cumSum = 0;
    for (let i = 0; i < playlist.length; i++) {
      cumSum += playlist[i].duration_seconds;
      if (elapsed < cumSum) {
        const offset = elapsed - (cumSum - playlist[i].duration_seconds);
        
        // Only update if the video index or the offset is significantly different
        if (i !== playingIndex) {
          playingIndex = i;
          playVideoAt(playingIndex, offset);
        } else {
          // Check if current time is far from the synced time (e.g., more than 2 seconds)
          const currentTime = video.currentTime;
          if (Math.abs(currentTime - offset) > 2) {
            video.currentTime = offset;
          }
        }
        break;
      }
    }
  }

  // Play video at index and offset
  function playVideoAt(i, offset) {
    if (!playlist[i]) return;
    const v = playlist[i];
    
    // Check if the video source needs to be changed
    if (video.src !== v.url) {
      video.src = v.url;
      // Set the offset only after the video is loaded
      video.onloadeddata = () => {
        video.currentTime = offset;
        video.play().catch(e => {
          console.log('Autoplay failed, muting and trying again:', e);
          video.muted = true;
          video.play();
        });
      };
    } else {
      // If the source is the same, just adjust the time
      video.currentTime = offset;
      video.play().catch(e => {
        console.log('Autoplay failed, muting and trying again:', e);
        video.muted = true;
        video.play();
      });
    }

    video.onended = () => {
      playingIndex = (playingIndex + 1) % playlist.length;
      playVideoAt(playingIndex, 0);
    };
  }

  // Initial setup and event listeners
  loadMuteState();
  loadJSON();

  // Add event listener for when the video is played
  video.onplaying = () => {
    // Only set up the timer once the video is playing
    // This allows for a smoother transition
    if (!syncIntervalId) {
      syncIntervalId = setInterval(syncAndPlay, 5_000); // Check for sync every 5 seconds
    }
  };
})();
</script>

</body>
</html>
