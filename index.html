<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>MSTV NETWORK</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body { font-family: Arial, sans-serif; background: #111; color: white; margin: 0; padding: 0; }
  header { text-align: center; padding: 10px; font-size: 24px; font-weight: bold; background: #222; }
  .poster-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 5px; padding: 10px; }
  .poster-grid img { width: 100%; border-radius: 5px; }
  .channel-select { text-align: center; padding: 10px; }
  select {
    padding: 5px;
    font-size: 16px;
    color: gold;
    background: #222;
    border: 1px solid gold;
    cursor: pointer;
  }
  select option {
    color: black;
  }
  .player-container { position: relative; width: 100%; max-width: 800px; margin: 0 auto; background: black; }
  iframe, video { width: 100%; height: 450px; }
  .mute-toggle {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(0,0,0,0.6);
    border-radius: 50%;
    padding: 5px;
    cursor: pointer;
    font-size: 20px;
    user-select: none;
  }
  .facebook-link { text-align: center; padding: 10px; }
  .facebook-link a { color: #3b5998; font-size: 18px; text-decoration: none; }
  footer { background: #222; text-align: center; padding: 15px; font-size: 14px; margin-top: 20px; }
  .banner { background: #0055ff; padding: 5px; white-space: nowrap; overflow: hidden; height: 24px; line-height: 24px; }
  .banner span { display: inline-block; padding-left: 100%; animation: scroll 15s linear infinite; }
  @keyframes scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
</style>
</head>
<body>

<header>MSTV NETWORK</header>

<div class="poster-grid">
  <img src="https://via.placeholder.com/150x80?text=Poster1" alt="Poster 1" />
  <img src="https://via.placeholder.com/150x80?text=Poster2" alt="Poster 2" />
  <img src="https://via.placeholder.com/150x80?text=Poster3" alt="Poster 3" />
  <img src="https://via.placeholder.com/150x80?text=Poster4" alt="Poster 4" />
</div>

<div class="channel-select">
  <select id="channelSelector">
    <option value="" selected disabled style="color:gold;">Click select channels</option>
  </select>
</div>

<div class="player-container">
  <div class="mute-toggle" id="muteToggle" title="Toggle mute">ðŸ”Š</div>
  <div id="player"></div>
  <div class="banner"><span id="scrollingBanner">No channel selected</span></div>
</div>

<div class="facebook-link">
  <a href="https://facebook.com" target="_blank" rel="noopener noreferrer">ðŸ“˜ Click here to follow</a>
</div>

<footer>
  <p>About Us: MSTV Network brings you globally synced live-style programming 24/7.</p>
  <p>&copy; 2025 MSTV Network. All Rights Reserved.</p>
</footer>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
const channels = [
  {
    name: "MSTV Channel 1",
    json_url: "https://raw.githubusercontent.com/mstvnetwork/mstv1/main/sync-ch1.json"
  },
  {
    name: "MSTV Channel 2",
    json_url: "https://raw.githubusercontent.com/mstvnetwork/mstv1/main/sync-ch2.json"
  }
];

let player;
let videoList = [];
let startTimeUTC = 0;
let isMuted = localStorage.getItem("muted") === "true";

// Placeholder video ID when no channel is selected
const placeholderVideoId = "dQw4w9WgXcQ"; // change to any YouTube video ID you like

// Populate dropdown
const channelSelector = document.getElementById("channelSelector");
channels.forEach(ch => {
  const option = document.createElement("option");
  option.value = ch.json_url;
  option.textContent = ch.name;
  option.style.color = "black";
  channelSelector.appendChild(option);
});

// Initialize YouTube Player with placeholder
function initPlayer() {
  player = new YT.Player("player", {
    videoId: placeholderVideoId,
    playerVars: { autoplay: 0, controls: 1 },
    events: {
      onReady: (event) => {
        if (isMuted) {
          event.target.mute();
          document.getElementById("muteToggle").textContent = "ðŸ”‡";
        } else {
          event.target.unMute();
          document.getElementById("muteToggle").textContent = "ðŸ”Š";
        }
      }
    }
  });
}

// Global sync logic to play selected channel video at correct position
function startGlobalSync() {
  if (!videoList.length) return;

  const now = Math.floor(Date.now() / 1000);
  const totalDuration = videoList.reduce((sum, v) => sum + v.duration_seconds, 0);
  let elapsed = (now - startTimeUTC) % totalDuration;

  let index = 0;
  while (elapsed >= videoList[index].duration_seconds) {
    elapsed -= videoList[index].duration_seconds;
    index = (index + 1) % videoList.length;
  }

  const videoId = videoList[index].id;
  const seekTo = elapsed;
  document.getElementById("scrollingBanner").textContent = videoList[index].title;

  if (player && typeof player.loadVideoById === "function") {
    player.loadVideoById({ videoId: videoId, startSeconds: seekTo });
    if (isMuted) player.mute(); else player.unMute();
  }
}

// Load selected channel's JSON and start playback
async function loadChannel(jsonUrl) {
  try {
    const response = await fetch(jsonUrl);
    const data = await response.json();
    videoList = data.video_list;
    startTimeUTC = new Date(data.start_time_utc).getTime() / 1000;
    startGlobalSync();
  } catch (error) {
    console.error("Error loading channel:", error);
  }
}

// Channel selector event
channelSelector.addEventListener("change", () => {
  if (channelSelector.value) {
    loadChannel(channelSelector.value);
  } else {
    // If somehow reset to no selection, show placeholder video
    document.getElementById("scrollingBanner").textContent = "No channel selected";
    player.loadVideoById({ videoId: placeholderVideoId, startSeconds: 0 });
  }
});

// Mute toggle
document.getElementById("muteToggle").addEventListener("click", () => {
  isMuted = !isMuted;
  localStorage.setItem("muted", isMuted);
  if (player) {
    if (isMuted) {
      player.mute();
      document.getElementById("muteToggle").textContent = "ðŸ”‡";
    } else {
      player.unMute();
      document.getElementById("muteToggle").textContent = "ðŸ”Š";
    }
  }
});

// Wait for YouTube API then init player with placeholder
function onYouTubeIframeAPIReady() {
  initPlayer();
}
</script>

</body>
</html>
