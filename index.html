<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>MSTV NETWORK</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body { font-family: Arial, sans-serif; background: #111; color: white; margin: 0; padding: 0; }
  header { text-align: center; padding: 10px; font-size: 24px; font-weight: bold; background: #222; }
  .poster-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 5px; padding: 10px; }
  .poster-grid img { width: 100%; border-radius: 5px; }
  .channel-select { text-align: center; padding: 10px; }
  select {
    padding: 5px;
    font-size: 16px;
    color: gold;
    background: #222;
    border: 1px solid gold;
    cursor: pointer;
  }
  select option {
    color: black;
  }
  .player-container { position: relative; width: 100%; max-width: 800px; margin: 0 auto; background: black; }
  video { width: 100%; height: 450px; background: black; }
  .mute-toggle {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(0,0,0,0.6);
    border-radius: 50%;
    padding: 5px;
    cursor: pointer;
    font-size: 20px;
    user-select: none;
    color: white;
  }
  .facebook-link { text-align: center; padding: 10px; }
  .facebook-link a { color: #3b5998; font-size: 18px; text-decoration: none; }
  footer { background: #222; text-align: center; padding: 15px; font-size: 14px; margin-top: 20px; }
  .banner {
    background: #0055ff;
    padding: 5px 0;
    white-space: nowrap;
    overflow: hidden;
    height: 24px;
    line-height: 24px;
    font-weight: bold;
  }
  .banner span {
    display: inline-block;
    padding-left: 100%;
    animation: scroll 15s linear infinite;
  }
  @keyframes scroll {
    0% { transform: translateX(0); }
    100% { transform: translateX(-100%); }
  }
</style>
</head>
<body>

<header>MSTV NETWORK</header>

<div class="poster-grid">
  <img src="https://via.placeholder.com/150x80?text=Poster1" alt="Poster 1" />
  <img src="https://via.placeholder.com/150x80?text=Poster2" alt="Poster 2" />
  <img src="https://via.placeholder.com/150x80?text=Poster3" alt="Poster 3" />
  <img src="https://via.placeholder.com/150x80?text=Poster4" alt="Poster 4" />
</div>

<div class="channel-select">
  <select id="channelSelector">
    <option value="" selected disabled style="color:gold;">Click select channels</option>
  </select>
</div>

<div class="player-container">
  <video id="videoPlayer" controls playsinline></video>
  <div class="mute-toggle" id="muteToggle" title="Toggle mute">ðŸ”Š</div>
  <div class="banner"><span id="scrollingBanner">No channel selected</span></div>
</div>

<div class="facebook-link">
  <a href="https://facebook.com" target="_blank" rel="noopener noreferrer">ðŸ“˜ Click here to follow</a>
</div>

<footer>
  <p>About Us: MSTV Network brings you globally synced live-style programming 24/7.</p>
  <p>&copy; 2025 MSTV Network. All Rights Reserved.</p>
</footer>

<script>
const channels = [
  {
    name: "MSTV Channel 1",
    json_url: "https://raw.githubusercontent.com/mstvnetwork/mstv1/main/sync-ch1.json"
  },
  {
    name: "MSTV Channel 2",
    json_url: "https://raw.githubusercontent.com/mstvnetwork/mstv1/main/sync-ch2.json"
  }
];

const videoPlayer = document.getElementById("videoPlayer");
const channelSelector = document.getElementById("channelSelector");
const muteToggle = document.getElementById("muteToggle");
const scrollingBanner = document.getElementById("scrollingBanner");

let videoList = [];
let startTimeUTC = 0;
let isMuted = localStorage.getItem("muted") === "true";
let currentVideoIndex = 0;

const placeholderVideoURL = "https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.webm";

function populateChannels() {
  channels.forEach(ch => {
    const option = document.createElement("option");
    option.value = ch.json_url;
    option.textContent = ch.name;
    option.style.color = "black";
    channelSelector.appendChild(option);
  });
}

function setPlaceholder() {
  videoPlayer.src = placeholderVideoURL;
  videoPlayer.pause();
  scrollingBanner.textContent = "No channel selected";
}

function updateMuteIcon() {
  muteToggle.textContent = isMuted ? "ðŸ”‡" : "ðŸ”Š";
}

muteToggle.addEventListener("click", () => {
  isMuted = !isMuted;
  videoPlayer.muted = isMuted;
  localStorage.setItem("muted", isMuted);
  updateMuteIcon();
});

// Core sync logic: calculate current video & elapsed position based on UTC time
function calculateSync() {
  if (!videoList.length) return null;

  const now = Math.floor(Date.now() / 1000);
  const totalDuration = videoList.reduce((sum, v) => sum + v.duration_seconds, 0);
  let elapsed = (now - startTimeUTC) % totalDuration;

  let index = 0;
  while (elapsed >= videoList[index].duration_seconds) {
    elapsed -= videoList[index].duration_seconds;
    index = (index + 1) % videoList.length;
  }
  return { index, elapsed };
}

// Load & play synced video based on current time
function playSyncedVideo() {
  if (!videoList.length) {
    setPlaceholder();
    return;
  }

  const sync = calculateSync();
  if (!sync) return;

  if (sync.index !== currentVideoIndex) {
    currentVideoIndex = sync.index;
    videoPlayer.src = videoList[currentVideoIndex].url;
    scrollingBanner.textContent = videoList[currentVideoIndex].title;
    videoPlayer.currentTime = sync.elapsed;
    videoPlayer.play().catch(() => {});
    videoPlayer.muted = isMuted;
    updateMuteIcon();
  } else {
    // Same video, just ensure time synced
    const diff = Math.abs(videoPlayer.currentTime - sync.elapsed);
    if (diff > 1) {
      videoPlayer.currentTime = sync.elapsed;
    }
  }
}

// When video ends, jump to next video respecting global sync
videoPlayer.addEventListener("ended", () => {
  // Just re-run playSyncedVideo() to jump to correct video by time
  playSyncedVideo();
});

// Regularly check to keep player synced every second
let syncInterval = null;
function startSyncInterval() {
  if (syncInterval) clearInterval(syncInterval);
  syncInterval = setInterval(playSyncedVideo, 1000);
}

// Load JSON playlist & start playback
async function loadChannel(jsonUrl) {
  try {
    const res = await fetch(jsonUrl);
    const data = await res.json();
    videoList = data.video_list;
    startTimeUTC = Math.floor(new Date(data.start_time_utc).getTime() / 1000);
    currentVideoIndex = 0;
    scrollingBanner.textContent = "Loading...";
    playSyncedVideo();
    startSyncInterval();
  } catch (err) {
    console.error("Failed to load channel JSON:", err);
    setPlaceholder();
  }
}

channelSelector.addEventListener("change", () => {
  if (channelSelector.value) {
    loadChannel(channelSelector.value);
  } else {
    setPlaceholder();
  }
});

// Init
populateChannels();
setPlaceholder();
updateMuteIcon();

</script>

</body>
</html>
