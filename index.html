<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>MSTV NETWORK</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body { margin:0; font-family: Arial,sans-serif; background:#111; color:#eee; }
  header { text-align:center; font-size:24px; font-weight:bold; background:#222; padding:10px; }
  .poster-grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(80px,1fr)); gap:5px; padding:10px; }
  .poster-grid img { width:100%; border-radius:5px; }
  .channel-select { text-align:center; padding:10px; }
  select { padding:5px; font-size:16px; }
  .player-container { position:relative; max-width:800px; margin:0 auto; background:#000; }
  video { width:100%; height:450px; background:#000; }
  .mute-toggle { position:absolute; top:10px; right:10px; background:rgba(0,0,0,0.6); border-radius:50%; padding:5px; cursor:pointer; font-size:20px; user-select:none; }
  .facebook-link { text-align:center; padding:10px; }
  .facebook-link a { color:#3b5998; font-size:18px; text-decoration:none; }
  footer { background:#222; text-align:center; padding:15px; font-size:14px; margin-top:20px; }
  .banner { background:#0055ff; padding:5px; white-space:nowrap; overflow:hidden; }
  .banner span { display:inline-block; padding-left:100%; animation: scroll 15s linear infinite; }
  @keyframes scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
</style>
</head>
<body>

<header>MSTV NETWORK</header>

<div class="poster-grid">
  <img src="https://via.placeholder.com/150x80?text=Poster1" />
  <img src="https://via.placeholder.com/150x80?text=Poster2" />
  <img src="https://via.placeholder.com/150x80?text=Poster3" />
  <img src="https://via.placeholder.com/150x80?text=Poster4" />
</div>

<div class="channel-select">
  <label for="channelSelector">Select Channel:</label>
  <select id="channelSelector"></select>
</div>

<div class="player-container">
  <video id="videoPlayer" playsinline></video>
  <div id="muteToggle" class="mute-toggle">ðŸ”Š</div>
  <div class="banner"><span id="scrollingBanner"></span></div>
</div>

<div class="facebook-link">
  <a href="https://facebook.com" target="_blank" rel="noopener">ðŸ“˜ Click here to follow</a>
</div>

<footer>
  <p>About Us: MSTV Network brings you globally synced live-style programming 24/7.</p>
  <p>&copy; 2025 MSTV Network. All Rights Reserved.</p>
</footer>

<script>
const channels = [
  {
    name: "MSTV Channel 1",
    json_url: "https://raw.githubusercontent.com/mstvnetwork/mstv1/main/sync-ch1.json"
  },
  {
    name: "MSTV Channel 2",
    json_url: "https://raw.githubusercontent.com/mstvnetwork/mstv1/main/sync-ch2.json"
  }
];

const videoPlayer = document.getElementById("videoPlayer");
const channelSelector = document.getElementById("channelSelector");
const muteToggle = document.getElementById("muteToggle");
const scrollingBanner = document.getElementById("scrollingBanner");

let videoList = [];
let startTimeUTC = 0;
let isMuted = localStorage.getItem("muted") === "true";
videoPlayer.muted = isMuted;
muteToggle.textContent = isMuted ? "ðŸ”‡" : "ðŸ”Š";

// Fill channel dropdown
channels.forEach(ch => {
  const opt = document.createElement("option");
  opt.value = ch.json_url;
  opt.textContent = ch.name;
  channelSelector.appendChild(opt);
});

// Load and start playback for selected channel
async function loadChannel(jsonUrl) {
  try {
    const res = await fetch(jsonUrl);
    const data = await res.json();
    videoList = data.video_list;
    startTimeUTC = new Date(data.start_time_utc).getTime() / 1000;
    playGlobalSync();
  } catch (e) {
    console.error("Failed to load channel JSON:", e);
  }
}

// Calculate which video to play & seek time
function playGlobalSync() {
  if (!videoList.length) return;

  const now = Math.floor(Date.now() / 1000);
  const totalDuration = videoList.reduce((acc, v) => acc + v.duration_seconds, 0);
  let elapsed = (now - startTimeUTC) % totalDuration;

  let index = 0;
  while (elapsed >= videoList[index].duration_seconds) {
    elapsed -= videoList[index].duration_seconds;
    index = (index + 1) % videoList.length;
  }

  // Update banner with current video title
  scrollingBanner.textContent = videoList[index].title;

  // Set video source and seek
  const currentVideo = videoList[index];
  if (videoPlayer.src !== currentVideo.url) {
    videoPlayer.src = currentVideo.url;
  }

  videoPlayer.currentTime = elapsed;
  videoPlayer.play().catch(() => {
    // Autoplay might fail without user interaction
  });
}

// When video ends, play next video
videoPlayer.addEventListener("ended", () => {
  // Just call playGlobalSync to jump to next video in loop
  playGlobalSync();
});

// Channel selector change
channelSelector.addEventListener("change", () => {
  loadChannel(channelSelector.value);
});

// Mute toggle
muteToggle.addEventListener("click", () => {
  isMuted = !isMuted;
  videoPlayer.muted = isMuted;
  localStorage.setItem("muted", isMuted);
  muteToggle.textContent = isMuted ? "ðŸ”‡" : "ðŸ”Š";
});

// Load first channel on page load
window.addEventListener("DOMContentLoaded", () => {
  channelSelector.selectedIndex = 0;
  loadChannel(channels[0].json_url);
});
</script>

</body>
</html>
